

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>functions &mdash; spectrapepper  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> spectrapepper
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">SpectraPepper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributions.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">spectrapepper</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for functions</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This main module contains all the functions available in spectrapepper. Please</span>
<span class="sd">use the search function to look up specific functionalities and keywords.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">factorial</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">butter</span><span class="p">,</span> <span class="n">filtfilt</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splev</span><span class="p">,</span> <span class="n">splrep</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">statistics</span> <span class="k">as</span> <span class="nn">sta</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">import</span> <span class="nn">linecache</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">os</span>


<div class="viewcode-block" id="load_mapp1"><a class="viewcode-back" href="../functions.html#functions.load_mapp1">[docs]</a><span class="k">def</span> <span class="nf">load_mapp1</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load sample specrtal data, axis included in the first line.</span>

<span class="sd">    :returns: Sample spectral data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;mapping1.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="load_mapp2"><a class="viewcode-back" href="../functions.html#functions.load_mapp2">[docs]</a><span class="k">def</span> <span class="nf">load_mapp2</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load sample specrtal data, axis included in the first line.</span>

<span class="sd">    :returns: Sample spectral data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;mapping2.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="k">def</span> <span class="nf">load_spectras</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load sample specrtal data, axis included in the first line.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Sample spectral data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;spectras.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">load_targets</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load sample targets data for the spectras.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Sample targets.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;targets.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">load_params</span><span class="p">(</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load sample parameters data for the spectras.</span>
<span class="sd">    </span>
<span class="sd">    :returns: Sample parameters.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;params.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">data</span>


<div class="viewcode-block" id="load"><a class="viewcode-back" href="../functions.html#functions.load">[docs]</a><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">fromline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load data from a standard text file obtained from LabSpec and other</span>
<span class="sd">    spectroscopy instruments. Normally, when single measurement these come in </span>
<span class="sd">    columns with the first one being the x-axis. When it is a mapping, the</span>
<span class="sd">    first row is the x-axis and the following are the measurements.</span>

<span class="sd">    :type file: str</span>
<span class="sd">    :param file: Url of data file. Must not have headers and separated by &#39;spaces&#39; (LabSpec).</span>
<span class="sd">    </span>
<span class="sd">    :type fromline: int</span>
<span class="sd">    :param fromline: Line of file from which to start loading data. The default is 0.</span>
<span class="sd">    </span>
<span class="sd">    :type transpose: boolean</span>
<span class="sd">    :param transpose: If True transposes the data. Default is False.</span>
<span class="sd">    </span>
<span class="sd">    :returns: List of the data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">fromline</span><span class="p">:</span>
            <span class="c1"># row = row.replace(&quot;,&quot;, &quot;.&quot;)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">)</span>
            <span class="n">s_row</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">s_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_row</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_row</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">raw_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_data</span></div>


<div class="viewcode-block" id="loadline"><a class="viewcode-back" href="../functions.html#functions.loadline">[docs]</a><span class="k">def</span> <span class="nf">loadline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random access to file. Loads a specific line in a file. Useful when</span>
<span class="sd">    managing large data files in processes where time is important. It can</span>
<span class="sd">    load numbers as floats.</span>

<span class="sd">    :type file: str</span>
<span class="sd">    :param file: Url od the data file</span>

<span class="sd">    :type line: int</span>
<span class="sd">    :param line: Line number. Counts from 0.</span>

<span class="sd">    :type dtype: str</span>
<span class="sd">    :param dtype: Type of data. If its numeric then &#39;float&#39;, if text then &#39;string&#39;.</span>
<span class="sd">        Default is &#39;float&#39;.</span>

<span class="sd">    :type split: boolean</span>
<span class="sd">    :param split: True to make a list of strings when &#39;tp&#39; is &#39;string&#39;, </span>
<span class="sd">        separated by space. The default is False.</span>

<span class="sd">    :returns: Array with the desired line.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">linecache</span><span class="o">.</span><span class="n">getline</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">split</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span></div>


<span class="k">def</span> <span class="nf">test_loads</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Only for tests purposes. Ingroed in documentation.</span>
<span class="sd">    </span>
<span class="sd">    :returns: A True is test is succesful.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;spectras.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">loadline</span><span class="p">(</span><span class="n">my_file</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">1461</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">,</span> <span class="s1">&#39;headers.txt&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">loadline</span><span class="p">(</span><span class="n">my_file</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="s1">&#39;second&#39;</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="k">return</span> <span class="n">default</span>


<div class="viewcode-block" id="lowpass"><a class="viewcode-back" href="../functions.html#functions.lowpass">[docs]</a><span class="k">def</span> <span class="nf">lowpass</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nyq</span><span class="o">=</span><span class="mf">0.75</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Butter low pass filter for a single or spectra or a list of them.</span>
<span class="sd">        </span>
<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of vectors in line format (each line is a vector).</span>
<span class="sd">    </span>
<span class="sd">    :type cutoff: float</span>
<span class="sd">    :param cutoff: Desired cutoff frequency of the filter. The default is 0.25.</span>
<span class="sd">    </span>
<span class="sd">    :type fs: int</span>
<span class="sd">    :param fs: Sample rate in Hz. The default is 30.</span>
<span class="sd">    </span>
<span class="sd">    :type order: int</span>
<span class="sd">    :param order: Sin wave can be approx represented as quadratic. The default is 2.</span>
<span class="sd">    </span>
<span class="sd">    :type nyq: float</span>
<span class="sd">    :param nyq: Nyquist frequency, 0.75*fs is a good value to start. The default is 0.75*30.</span>

<span class="sd">    :returns: Filtered data</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># so it does not change the input list</span>
    <span class="n">normal_cutoff</span> <span class="o">=</span> <span class="n">cutoff</span> <span class="o">/</span> <span class="p">(</span><span class="n">nyq</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">normal_cutoff</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="n">analog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="normtomax"><a class="viewcode-back" href="../functions.html#functions.normtomax">[docs]</a><span class="k">def</span> <span class="nf">normtomax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">zeromin</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes spectras to the maximum value of each, in other words, the</span>
<span class="sd">    maximum value of each spectras is set to 1.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Single or multiple vectors to normalize.</span>
<span class="sd">        </span>
<span class="sd">    :type zeromin: boolean</span>
<span class="sd">    :param zeromin: If `True`, the minimum value is traslated to 0. Default</span>
<span class="sd">        values is `False`</span>
<span class="sd">    </span>
<span class="sd">    :returns: Normalized data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># so it does not chamge the input list</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># detect dimensions</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>           
            <span class="k">if</span> <span class="n">zeromin</span><span class="p">:</span>
                <span class="n">min_data</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_data</span>
            <span class="n">max_data</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">max_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">zeromin</span><span class="p">:</span>
            <span class="n">min_data</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span>  <span class="n">min_data</span>
        <span class="n">max_data</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">max_data</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="normtovalue"><a class="viewcode-back" href="../functions.html#functions.normtovalue">[docs]</a><span class="k">def</span> <span class="nf">normtovalue</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes the spectras to a set value, in other words, the defined value</span>
<span class="sd">    will be reescaled to 1 in all the spectras.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Single or multiple vectors to normalize.</span>

<span class="sd">    :type val: float</span>
<span class="sd">    :param val: Value to normalize to.</span>

<span class="sd">    :returns: Normalized data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># so it does not change the input list</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">val</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="alsbaseline"><a class="viewcode-back" href="../functions.html#functions.alsbaseline">[docs]</a><span class="k">def</span> <span class="nf">alsbaseline</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculation of the baseline using Asymmetric Least Squares Smoothing. This</span>
<span class="sd">    script only makes the calculation but it does not remove it. Original idea of</span>
<span class="sd">    this algorithm by P. Eilers and H. Boelens (2005):</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Spectra to calculate the baseline from.</span>

<span class="sd">    :type lam: int</span>
<span class="sd">    :param lam: Lambda, smoothness. The default is 100.</span>

<span class="sd">    :type p: float</span>
<span class="sd">    :param p: Asymmetry. The default is 0.001.</span>

<span class="sd">    :type niter: int</span>
<span class="sd">    :param niter: Niter. The default is 10.</span>

<span class="sd">    :returns: Returns the calculated baseline.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># detect dimensions    </span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">W</span> <span class="o">+</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">d</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>       
                <span class="n">z</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">w</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span>  
            
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="p">):</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">spdiags</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">W</span> <span class="o">+</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">d</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">spsolve</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">w</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">z</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="bspbaseline"><a class="viewcode-back" href="../functions.html#functions.bspbaseline">[docs]</a><span class="k">def</span> <span class="nf">bspbaseline</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcuates the baseline using b-spline.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Single or several spectras to remove the baseline from.</span>

<span class="sd">    :type axis: list[float]</span>
<span class="sd">    :param axis: x axis of the data, to interpolate the baseline function.</span>

<span class="sd">    :type points: list[int]</span>
<span class="sd">    :param points: axis values of points to calculate the bspine.</span>

<span class="sd">    :type avg: int</span>
<span class="sd">    :param avg: points to each side to make average.</span>

<span class="sd">    :type remove: True</span>
<span class="sd">    :param remove: if True, calculates and returns (data - baseline).</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: if True, calculates and returns (data - baseline).    </span>

<span class="sd">    :returns: The baseline.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">valtopos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># detect dimensions</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># y values for the selected x</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)):</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">avg</span><span class="p">:</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        
            <span class="n">spl</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                <span class="n">baseline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">splev</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">spl</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">baseline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splev</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">spl</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># y values for the selected x</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">avg</span><span class="p">:</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    
        <span class="n">spl</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">spl</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>        
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">baseline</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">baseline</span>

    <span class="k">return</span> <span class="n">baseline</span></div>


<div class="viewcode-block" id="polybaseline"><a class="viewcode-back" href="../functions.html#functions.polybaseline">[docs]</a><span class="k">def</span> <span class="nf">polybaseline</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcuates the baseline using polynomial fit.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Single or several spectras to remove the baseline from.</span>

<span class="sd">    :type axis: list[float]</span>
<span class="sd">    :param axis: x axis of the data, to interpolate the baseline function.</span>

<span class="sd">    :type points: list[int]</span>
<span class="sd">    :param points: positions in axis of points to calculate baseline.</span>

<span class="sd">    :type deg: int</span>
<span class="sd">    :param deg: Polynomial degree of the fit.</span>

<span class="sd">    :type avg: int</span>
<span class="sd">    :param avg: points to each side to make average.</span>

<span class="sd">    :type remove: True</span>
<span class="sd">    :param remove: if True, calculates and returns (data - baseline).</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: if True, calculates and returns (data - baseline).    </span>

<span class="sd">    :returns: The baseline.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  
    <span class="n">axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">valtopos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># detect dimensions</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># y values for the selected x</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)):</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">avg</span><span class="p">:</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>  <span class="c1"># polinomial fit</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># 1d polinomial</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>  <span class="c1"># y values</span>
            <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>        
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
            <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp</span>
            <span class="n">baseline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># y values for the selected x</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">avg</span><span class="p">:</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">deg</span><span class="p">)</span>  <span class="c1"># polinomial fit</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># 1d polinomial</span>
        <span class="n">baseline</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>  <span class="c1"># y values</span>
    
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>        
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">baseline</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="n">baseline</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">baseline</span>

    <span class="k">return</span> <span class="n">baseline</span></div>


<span class="c1"># def lorentzfit(y, x, wid=4, it=100, plot=False):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Fit a Lorentz distributed curve for a single spectra.</span>

<span class="c1">#     :type y: list[float]</span>
<span class="c1">#     :param y: single spectra.</span>

<span class="c1">#     :type x: list[float]</span>
<span class="c1">#     :param x: x-axis.</span>

<span class="c1">#     :type wid: float, optional</span>
<span class="c1">#     :param wid: fitted curve width. The default is 4.</span>

<span class="c1">#     :type it: int, optional</span>
<span class="c1">#     :param it: number of iterations. The default is 100.</span>

<span class="c1">#     :type plot: boolean</span>
<span class="c1">#     :param plot: fF &#39;True&#39; then plots the data and the fit.</span>

<span class="c1">#     :returns: Lorentz fit.</span>
<span class="c1">#     :rtype: list[float]</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     cen = 0  # position (wavelength, x value)</span>
<span class="c1">#     peak_i_pos = 0  # position (axis position, i value)</span>
<span class="c1">#     amp = max(y)  # maximum value of function, peak value, amplitud of the fit</span>
<span class="c1">#     #  fit = []  # fit function</span>
<span class="c1">#     err = []  # error log to choose the optimum</span>
<span class="c1">#     for i in range(len(y)):  # for all the data</span>
<span class="c1">#         if amp == y[i]:  # if it is the maximum</span>
<span class="c1">#             cen = x[i]  # save the axis value x</span>
<span class="c1">#             peak_i_pos = int(i)  # also save the position i</span>
<span class="c1">#             break</span>
<span class="c1">#     for i in range(it):  # search &quot;it&quot; iterations</span>
<span class="c1">#         temp = 0  # reset temporal error</span>
<span class="c1">#         fit = []  # reset lorentz fit array</span>
<span class="c1">#         p = cen - 0.5 + (0.01 * i)  # pos of the peak respect to the reference measured peak</span>
<span class="c1">#         for j in range(len(x)):  # for all the points</span>
<span class="c1">#             fit.append(amp * wid ** 2 / ((x[j] - p) ** 2 + wid ** 2))</span>
<span class="c1">#         for j in range(peak_i_pos - 25, peak_i_pos + 25):  # error between -25 and +25 of the peak position</span>
<span class="c1">#             temp = temp + (fit[j] - y[j]) ** 2  # total error</span>
<span class="c1">#         err.append(temp)  # log error</span>
<span class="c1">#     fit = []  # reset array</span>
<span class="c1">#     for i in range(len(err)):  # look for the minimum error</span>
<span class="c1">#         if min(err) == err[i]:  # if it is the minimum error</span>
<span class="c1">#             p = cen - 0.5 + (0.01 * i)  # then calculate the fit again</span>
<span class="c1">#             for j in range(len(y)):</span>
<span class="c1">#                 fit.append(amp * wid ** 2 / ((x[j] - p) ** 2 + wid ** 2))</span>
<span class="c1">#             break</span>

<span class="c1">#     if plot:</span>
<span class="c1">#         plt.plot(x, y, label=&#39;Data&#39;)</span>
<span class="c1">#         plt.plot(x, fit, label=&#39;Fit&#39;)</span>
<span class="c1">#         plt.legend(loc=0)</span>
<span class="c1">#         plt.show()</span>

<span class="c1">#     return fit</span>


<div class="viewcode-block" id="gaussfit0"><a class="viewcode-back" href="../functions.html#functions.gaussfit0">[docs]</a><span class="k">def</span> <span class="nf">gaussfit0</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">4.4</span><span class="p">,</span> <span class="n">it</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit a Gaussian distributed curve for a single spectra. Good guidelines</span>
<span class="sd">    for similar structures can be found at http://emilygraceripka.com/blog/16.</span>

<span class="sd">    :type y: list[float]</span>
<span class="sd">    :param x: single spectra.</span>

<span class="sd">    :type x: list[float]</span>
<span class="sd">    :param x: x-axis.</span>

<span class="sd">    :type sigma: float</span>
<span class="sd">    :param sigma: sigma parameter of distribution. The default is 4.4.</span>

<span class="sd">    :type it: int</span>
<span class="sd">    :param it: number of iterations. The default is 100.</span>

<span class="sd">    :type plot: boolean</span>
<span class="sd">    :param plot: fF &#39;True&#39; then plots the data and the fit.</span>

<span class="sd">    :returns: Gaussian fit.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># x = list(ax)  # change the variable so it doesnt change the original</span>
    <span class="c1"># y = list(data_x)  # change the variable so it doesnt change the original</span>
    <span class="n">cen</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># position (wavelength, x value)</span>
    <span class="n">peak_i_pos</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># position (axis position, i value)</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># maximum value of function, peak value, amplitude of the fit</span>
    <span class="c1"># fit = []  # fit function</span>
    <span class="n">err</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># error log to choose the optimum</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>  <span class="c1"># for all the data</span>
        <span class="k">if</span> <span class="n">amp</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>  <span class="c1"># if it is the maximum</span>
            <span class="n">cen</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># save the axis value x</span>
            <span class="n">peak_i_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># also save the position i</span>
            <span class="k">break</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">it</span><span class="p">):</span>  <span class="c1"># search &quot;it&quot; iterations</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reset temporal error</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># reset lorentz fit array</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">cen</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>  <span class="c1"># pos of the peak respect to the reference measured peak</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">11</span> <span class="o">*</span> <span class="n">amp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">peak_i_pos</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="n">peak_i_pos</span> <span class="o">+</span> <span class="mi">25</span><span class="p">):</span>  <span class="c1"># error between -25 and +25 of the peak position</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># total error</span>
        <span class="n">err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>  <span class="c1"># log error</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># reset array</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">err</span><span class="p">)):</span>  <span class="c1"># look for the minimum error</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">==</span> <span class="n">err</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>  <span class="c1"># if it is the minimum error</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">cen</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>  <span class="c1"># then calculate the fit again</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">11</span> <span class="o">*</span> <span class="n">amp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))))</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="valtopos"><a class="viewcode-back" href="../functions.html#functions.valtopos">[docs]</a><span class="k">def</span> <span class="nf">valtopos</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To translate the value in an axis to its position in the axis, basically</span>
<span class="sd">    searches for the position of the value. It approximates to the closest.</span>

<span class="sd">    :type vals: list[float]</span>
<span class="sd">    :param vals: List of values to be searched and translated.</span>

<span class="sd">    :type axis: list[float]</span>
<span class="sd">    :param axis: Axis.</span>

<span class="sd">    :returns: Position in the axis of the values in vals</span>
<span class="sd">    :rtype: list[int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">shape</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">shape</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))]</span>  <span class="c1"># i position of area limits</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>  <span class="c1"># this loop takes the approx. x and takes its position</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="n">dif_temp</span> <span class="o">=</span> <span class="mi">999</span>  <span class="c1"># safe initial difference</span>
                <span class="n">temp_pos</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># temporal best position</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)):</span>  <span class="c1"># search in axis</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">axis</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dif_temp</span><span class="p">:</span>  <span class="c1"># compare if better</span>
                        <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">k</span>  <span class="c1"># save best value</span>
                        <span class="n">dif_temp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">axis</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>  <span class="c1"># calculate new diff</span>
                <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="n">temp_pos</span><span class="p">]</span>  <span class="c1"># save real value in axis</span>
                <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_pos</span>  <span class="c1"># save the position</span>
                
    <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))]</span>  <span class="c1"># i position of area limits</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>  <span class="c1"># this loop takes the approx. x and takes its position</span>
            <span class="n">dif_temp</span> <span class="o">=</span> <span class="mi">999</span>  <span class="c1"># safe initial difference</span>
            <span class="n">temp_pos</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># temporal best position</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)):</span>  <span class="c1"># search in axis</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">axis</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dif_temp</span><span class="p">:</span>  <span class="c1"># compare if better</span>
                    <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">k</span>  <span class="c1"># save best value</span>
                    <span class="n">dif_temp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">axis</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>  <span class="c1"># calculate new diff</span>
            <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="n">temp_pos</span><span class="p">]</span>  <span class="c1"># save real value in axis</span>
            <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_pos</span>  <span class="c1"># save the position           </span>
                
    <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># i position of area limits</span>
        <span class="n">dif_temp</span> <span class="o">=</span> <span class="mi">999</span>  <span class="c1"># safe initial difference</span>
        <span class="n">temp_pos</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># temporal best position</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vals</span> <span class="o">-</span> <span class="n">axis</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">dif_temp</span><span class="p">:</span>
                <span class="n">temp_pos</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">dif_temp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vals</span> <span class="o">-</span> <span class="n">axis</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">axis</span><span class="p">[</span><span class="n">temp_pos</span><span class="p">]</span>  <span class="c1"># save real value in axis</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">temp_pos</span>
    <span class="k">return</span> <span class="n">pos</span></div>


<div class="viewcode-block" id="areacalculator"><a class="viewcode-back" href="../functions.html#functions.areacalculator">[docs]</a><span class="k">def</span> <span class="nf">areacalculator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Area calculator using the data (x_data) and the limits in position, not</span>
<span class="sd">    values.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to calculate area from</span>

<span class="sd">    :type limits: list[int]</span>
<span class="sd">    :param limits: Limits that define the areas to be calculated. Axis position.</span>
<span class="sd">    </span>
<span class="sd">    :type norm: bool</span>
<span class="sd">    :param norm: If True, normalized the area to the sum under all the curve.</span>

<span class="sd">    :returns: A list of areas according to the requested limits.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">))]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>  <span class="c1"># final values of areas</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># calculate the areas for all the points</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">)):</span>  <span class="c1"># for all the areas</span>
                <span class="n">areas</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">limits</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># calculate the sum</span>
                <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
                    <span class="n">areas</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">))]</span>  <span class="c1"># final values of areas</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">limits</span><span class="p">)):</span>  <span class="c1"># for all the areas</span>
            <span class="n">areas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># calculate the sum</span>
            <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
                <span class="n">areas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">areas</span></div>


<div class="viewcode-block" id="bincombs"><a class="viewcode-back" href="../functions.html#functions.bincombs">[docs]</a><span class="k">def</span> <span class="nf">bincombs</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s_max</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns all possible unique combinations.</span>

<span class="sd">    :type n: int</span>
<span class="sd">    :param n: Amount of positions.</span>

<span class="sd">    :type s_min: int</span>
<span class="sd">    :param s_min: Minimum amount of 1s.</span>

<span class="sd">    :type s_max: int</span>
<span class="sd">    :param s_max: Maximum amount of 1s.</span>

<span class="sd">    :returns: List of unique combinations.</span>
<span class="sd">    :rtype: list[tuple]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s_max</span><span class="p">)</span>
    <span class="n">s_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s_min</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">s_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">s_max</span> <span class="o">=</span> <span class="n">n</span>

    <span class="n">iters</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># final matrix</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># temp matrix</span>
    <span class="n">stuff</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># matrix of ALL combinations</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># create possibilities vector (0 and 1)</span>
        <span class="n">stuff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">stuff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">stuff</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>  <span class="c1"># get ALL combinations possible from &quot;stuff&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)):</span>  <span class="c1"># for all the possibilities...</span>
        <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iters</span><span class="p">)):</span>  <span class="c1"># check if it already exists</span>
            <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">iters</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>  <span class="c1"># if it matches, add 1</span>
                <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">+=</span> <span class="mi">0</span>  <span class="c1"># if not, add 0</span>
        <span class="c1"># e == 0 and sum(temp[i]) &gt;= s_min and sum(temp[i]) &lt;= s_max</span>
        <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">s_min</span> <span class="o">&lt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">s_max</span><span class="p">:</span>
            <span class="n">iters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># if new and fall into the criteria, then add</span>

    <span class="k">return</span> <span class="n">iters</span></div>


<div class="viewcode-block" id="normsum"><a class="viewcode-back" href="../functions.html#functions.normsum">[docs]</a><span class="k">def</span> <span class="nf">normsum</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes the sum under the curve to 1, for single or multiple spectras.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Single spectra or a list of them.</span>

<span class="sd">    :returns: Normalized data</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">s</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="normtoglobalmax"><a class="viewcode-back" href="../functions.html#functions.normtoglobalmax">[docs]</a><span class="k">def</span> <span class="nf">normtoglobalmax</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes a list of spectras to the global max.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of spectras.</span>

<span class="sd">    :returns: Normalized data</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">maximum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99999999</span>  <span class="c1"># safe start</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">maximum</span><span class="p">:</span>
                    <span class="n">maximum</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">normtovalue</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">maximum</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if s single vector, then is the same as nortomax (loca)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">normtomax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="interpolation"><a class="viewcode-back" href="../functions.html#functions.interpolation">[docs]</a><span class="k">def</span> <span class="nf">interpolation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">new_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolates data to a new axis. If there are multiple datasets with </span>
<span class="sd">    different axises in can interpolate to a common axis.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of data to interpolate</span>

<span class="sd">    :type axis: list[list[float]]</span>
<span class="sd">    :param axis: list of the axises of the data</span>
<span class="sd">    </span>
<span class="sd">    :type new_step: float</span>
<span class="sd">    :param new_step: new step for the new axis</span>
<span class="sd">    </span>
<span class="sd">    :type integer: bool</span>
<span class="sd">    :param integer: </span>

<span class="sd">    :returns: Interpolated data and the new axis</span>
<span class="sd">    :rtype: list[float], list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># NEW AXIS</span>
        <span class="n">new_start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999999</span>
        <span class="n">new_end</span> <span class="o">=</span> <span class="mi">99999999</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">new_start</span><span class="p">:</span>
                <span class="n">new_start</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">new_end</span><span class="p">:</span>
                <span class="n">new_end</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">new_start</span><span class="p">,</span> <span class="n">new_end</span> <span class="o">+</span> <span class="n">new_step</span><span class="p">,</span> <span class="n">new_step</span><span class="p">)</span>
    
        <span class="c1"># MASTER DATA</span>
        <span class="n">master_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_y</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_y</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="n">this</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">()</span>
                <span class="n">master_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
    
        <span class="c1"># INTERPOLATIONS</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master_y</span><span class="p">)):</span>
            <span class="n">master_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">master_y</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x_new</span><span class="p">)</span>
            
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># NEW AXIS</span>
        <span class="n">new_start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999999</span>
        <span class="n">new_end</span> <span class="o">=</span> <span class="mi">99999999</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">new_start</span><span class="p">:</span>
            <span class="n">new_start</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">axis</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">new_end</span><span class="p">:</span>
            <span class="n">new_end</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">axis</span><span class="p">))</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">new_start</span><span class="p">,</span> <span class="n">new_end</span> <span class="o">+</span> <span class="n">new_step</span><span class="p">,</span> <span class="n">new_step</span><span class="p">)</span>
    
        <span class="c1"># MASTER DATA</span>
        <span class="n">master_y</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">this</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">temp_y</span><span class="p">)</span>
    
        <span class="c1"># INTERPOLATIONS</span>
        <span class="n">master_y</span> <span class="o">=</span> <span class="n">this</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">master_y</span><span class="p">,</span> <span class="n">x_new</span></div>


<div class="viewcode-block" id="evalgrau"><a class="viewcode-back" href="../functions.html#functions.evalgrau">[docs]</a><span class="k">def</span> <span class="nf">evalgrau</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function evaluates the MSE in 3 dimensions (x,y,z) for a set of</span>
<span class="sd">    data vectors.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: A list of lists of variables to compare.</span>

<span class="sd">    :returns: A list with each combination and the R2 score obtained.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">tup</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>  <span class="c1"># number list of data type sets</span>
    <span class="n">combs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">tup</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># make all combinations</span>
    <span class="n">n_o_p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># R2 list</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">combs</span><span class="p">)):</span>  <span class="c1"># for all the combinations</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">combs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># temporal x axis</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">combs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># temporal y axis</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">combs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># temporal z axis</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># fit function parameter</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># fit function parameter</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_o_p</span><span class="p">):</span>  <span class="c1"># for all the data points</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">xs</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">ys</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># A value</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># b value</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># transpose matrix form</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># matrix form</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">I</span> <span class="o">*</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">b</span>  <span class="c1"># evaluate fir</span>
        <span class="n">rss</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># residual sum of squares</span>
        <span class="n">tss</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># total sum of squares</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_o_p</span><span class="p">):</span>  <span class="c1"># calculate mse for all the points</span>
            <span class="n">rss</span> <span class="o">+=</span> <span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">fit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">fit</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># residual sum</span>
            <span class="n">tss</span> <span class="o">+=</span> <span class="p">(</span><span class="n">zs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">zs</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># total error</span>
        <span class="n">r2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rss</span> <span class="o">/</span> <span class="n">tss</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">combs</span><span class="p">,</span> <span class="n">r2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">merged</span></div>


<div class="viewcode-block" id="groupscores"><a class="viewcode-back" href="../functions.html#functions.groupscores">[docs]</a><span class="k">def</span> <span class="nf">groupscores</span><span class="p">(</span><span class="n">all_targets</span><span class="p">,</span> <span class="n">used_targets</span><span class="p">,</span> <span class="n">predicted_targets</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the individual scores for a ML algorithm (i.e.: LDA, PCA, etc).</span>

<span class="sd">    :type all_targets: list[int]</span>
<span class="sd">    :param all_targets: List of all real targets (making sure all groups are </span>
<span class="sd">        here).</span>

<span class="sd">    :type used_targets: list[int]</span>
<span class="sd">    :param used_targets: Targets to score on.</span>

<span class="sd">    :type predicted_targets: list[int]</span>
<span class="sd">    :param predicted_targets: Prediction of used_targets.</span>

<span class="sd">    :returns: List of scores for each group.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g_count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">all_targets</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))]</span>  <span class="c1"># list to count points per group</span>
    <span class="n">g_scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">all_targets</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))]</span>  <span class="c1"># list to store the scores</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g_scores</span><span class="p">)):</span>  <span class="c1"># for all the groups</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicted_targets</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
            <span class="k">if</span> <span class="n">used_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">g_count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">predicted_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">used_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">g_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g_scores</span><span class="p">)):</span>
        <span class="n">g_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">g_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">g_count</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">g_scores</span></div>


<div class="viewcode-block" id="cmscore"><a class="viewcode-back" href="../functions.html#functions.cmscore">[docs]</a><span class="k">def</span> <span class="nf">cmscore</span><span class="p">(</span><span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the distance between points and the center of mass (CM) of</span>
<span class="sd">    clusters and sets the prediction to the closest CM. This score may be</span>
<span class="sd">    higher or lower than the algorithm score.</span>

<span class="sd">    :type x_points: list[float]</span>
<span class="sd">    :param x_points: Coordinates of x-axis.</span>

<span class="sd">    :type y_points: list[float]</span>
<span class="sd">    :param y_points: Coordinates of y-axis.</span>

<span class="sd">    :type target: list[int]</span>
<span class="sd">    :param target: Targets of each point.</span>

<span class="sd">    :returns: Score by comparing CM distances. Prediction using CM distances. </span>
<span class="sd">        X-axis coords of ths CMs. Y-axis coords of the Cms.</span>
<span class="sd">    :rtype: list[float, list[int],list[float],list[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span>
    <span class="n">y_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span>
    <span class="n">tar</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">g_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>  <span class="c1"># avg D1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>  <span class="c1"># avg D2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>  <span class="c1"># N for each group</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># distances</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># predictions</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">x_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">y_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)):</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">temp3</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
            <span class="n">temp3</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                          <span class="o">+</span> <span class="p">(</span><span class="n">y_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">temp3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">temp2</span><span class="p">:</span>
                <span class="n">temp2</span> <span class="o">=</span> <span class="n">temp3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">temp1</span> <span class="o">=</span> <span class="n">j</span>

        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">temp1</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">score</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span></div>


<div class="viewcode-block" id="mdscore"><a class="viewcode-back" href="../functions.html#functions.mdscore">[docs]</a><span class="k">def</span> <span class="nf">mdscore</span><span class="p">(</span><span class="n">x_p</span><span class="p">,</span> <span class="n">y_p</span><span class="p">,</span> <span class="n">tar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the distance between points and the median center (MD) of</span>
<span class="sd">    clusters and sets the prediction to the closest MD. This score may be</span>
<span class="sd">    higher or lower than the algorithm score.</span>

<span class="sd">    :type x_p: list[float]</span>
<span class="sd">    :param x_p: Coordinates of x-axis.</span>

<span class="sd">    :type y_p: list[float]</span>
<span class="sd">    :param y_p: Coordinates of y-axis.</span>

<span class="sd">    :type tar: list[int]</span>
<span class="sd">    :param tar: Targets of each point.</span>

<span class="sd">    :returns: Score by comparing MD distances. Prediction using MD distances. </span>
<span class="sd">        X-axis coords of ths CMs. Y-axis coords of the Cms.</span>
<span class="sd">    :rtype: list[float, list[int],list[float],list[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x_p</span><span class="p">)</span>
    <span class="n">y_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_p</span><span class="p">)</span>
    <span class="n">g_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">tar</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># distances</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># predictions</span>

    <span class="n">x_s</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>
    <span class="n">y_s</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">tar</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">x_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">y_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_p</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x_s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y_s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">)):</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">temp3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_n</span><span class="p">):</span>
            <span class="n">temp3</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                          <span class="o">+</span> <span class="p">(</span><span class="n">y_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">temp3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">temp2</span><span class="p">:</span>
                <span class="n">temp2</span> <span class="o">=</span> <span class="n">temp3</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">temp1</span> <span class="o">=</span> <span class="n">j</span>

        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">temp1</span><span class="p">:</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">score</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tar</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">score</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span></div>


<div class="viewcode-block" id="normtopeak"><a class="viewcode-back" href="../functions.html#functions.normtopeak">[docs]</a><span class="k">def</span> <span class="nf">normtopeak</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes the spectras to a particular peak.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to be normalized.</span>

<span class="sd">    :type axis: list[float]</span>
<span class="sd">    :param axis: X-axis of the data</span>

<span class="sd">    :type peak: int</span>
<span class="sd">    :param peak: Peak position in x-axis values.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Range to look for the real peak. The default is 10.</span>

<span class="sd">    :returns: Normalized data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="n">axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="c1"># peak = [int(peak)]</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">valtopos</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">peak</span><span class="p">)],</span> <span class="n">axis</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">section</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">:</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">]</span>
            <span class="n">highest</span> <span class="o">=</span> <span class="n">peakfinder</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">shift</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        
            <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">highest</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">highest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>
        
            <span class="n">local_max</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">c</span><span class="p">]</span>
            <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">local_max</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">:</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">]</span>
        <span class="n">highest</span> <span class="o">=</span> <span class="n">peakfinder</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">shift</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">highest</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">highest</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
    
        <span class="n">local_max</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">c</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">local_max</span>
    <span class="k">return</span> <span class="n">y</span></div>


<div class="viewcode-block" id="peakfinder"><a class="viewcode-back" href="../functions.html#functions.peakfinder">[docs]</a><span class="k">def</span> <span class="nf">peakfinder</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">look</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the location of the peaks in a single vector.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to find a peak in.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: Amount of position to each side to decide if it is a local </span>
<span class="sd">        maximum. The default is 10.</span>

<span class="sd">    :returns: A vector of same length with 1 or 0 if it finds or not a peak in </span>
<span class="sd">        that position</span>
<span class="sd">    :rtype: list[int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">is_max</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">is_min</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">look</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">look</span><span class="p">):</span>  <span class="c1"># start at &quot;look&quot; to avoid o.o.r</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># negative if lower, positive if higher</span>
        <span class="n">higher</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">look</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">look</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]:</span>  <span class="c1"># search all range lower</span>
                <span class="n">lower</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># +1 if lower</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">look</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="ow">and</span>
                  <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]):</span>  <span class="c1"># search all range higher</span>
                <span class="n">higher</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># +1 if higher</span>
        <span class="k">if</span> <span class="n">higher</span> <span class="o">==</span> <span class="n">look</span><span class="p">:</span>  <span class="c1"># if all higher then its local max</span>
            <span class="n">is_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">is_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">lower</span> <span class="o">==</span> <span class="n">look</span><span class="p">:</span>  <span class="c1"># if all lower then its local min</span>
            <span class="n">is_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">is_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">is_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">is_max</span></div>


<div class="viewcode-block" id="confusionmatrix"><a class="viewcode-back" href="../functions.html#functions.confusionmatrix">[docs]</a><span class="k">def</span> <span class="nf">confusionmatrix</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">gn</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
                    <span class="n">cmm</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates and/or plots the confusion matrix for machine learning algorithm</span>
<span class="sd">    results.</span>

<span class="sd">    :type tt: list[float]</span>
<span class="sd">    :param tt: Real targets.</span>

<span class="sd">    :type tp: list[float]</span>
<span class="sd">    :param tp: Predicted targets.</span>

<span class="sd">    :type plot: boolean</span>
<span class="sd">    :param plot: If true, plots the matrix. The default is False</span>

<span class="sd">    :type gn: list[str]</span>
<span class="sd">    :param gn: Names, or lables , of the classification groups. Default is empty.</span>

<span class="sd">    :type title: str</span>
<span class="sd">    :param title: Name of the matrix. Default is empty.</span>

<span class="sd">    :type cmm: str</span>
<span class="sd">    :param cmm: Nam eof the colormap (matplotlib) to use for the plot. Default</span>
<span class="sd">        is Blue.</span>

<span class="sd">    :type fontsize: int</span>
<span class="sd">    :param fontsize: Font size for the labels. The default is 20.</span>

<span class="sd">    :type ylabel: str</span>
<span class="sd">    :param ylabel: Label for y axis. Default is `True`.</span>
<span class="sd">    </span>
<span class="sd">    :type xlabel: str</span>
<span class="sd">    :param xlabel: Label for x axis. Default is `Prediction`.</span>
<span class="sd">    </span>
<span class="sd">    :returns: The confusion matrix</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
    <span class="n">group_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gn</span><span class="p">)</span>
    <span class="n">gn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_names</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">cmm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmm</span><span class="p">)</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gn</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gn</span><span class="p">)]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gn</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">tt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tt</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">tp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span> <span class="ow">and</span> <span class="n">tt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">:</span>
                    <span class="n">m</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)):</span>
        <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmm</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group_names</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group_names</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">group_names</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">group_names</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gn</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gn</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">m</span></div>


<div class="viewcode-block" id="avg"><a class="viewcode-back" href="../functions.html#functions.avg">[docs]</a><span class="k">def</span> <span class="nf">avg</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the average vector from a list of vectors.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of vectors.</span>

<span class="sd">    :returns: The average of the vectors in the list.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">avg_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">avg_data</span> <span class="o">=</span> <span class="n">avg_data</span> <span class="o">+</span> <span class="n">i</span>
    <span class="n">avg_data</span> <span class="o">=</span> <span class="n">avg_data</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">avg_data</span></div>


<div class="viewcode-block" id="sdev"><a class="viewcode-back" href="../functions.html#functions.sdev">[docs]</a><span class="k">def</span> <span class="nf">sdev</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the standard deviation for each bin from a list of vectors.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of vectors.</span>

<span class="sd">    :returns: Standard deviation curve</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">curve_std</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># stdev for each step</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">curve_std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sta</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>  <span class="c1"># stdev for each step</span>
    <span class="n">curve_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">curve_std</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">curve_std</span></div>


<div class="viewcode-block" id="median"><a class="viewcode-back" href="../functions.html#functions.median">[docs]</a><span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the median vector of a list of vectors.</span>
<span class="sd">    </span>
<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of vectors.</span>

<span class="sd">    :returns: median curve</span>
<span class="sd">    :rtype: list[float]    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">median</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">meas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meas</span><span class="p">):</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
        <span class="n">median</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>    
    <span class="k">return</span> <span class="n">median</span></div>


<div class="viewcode-block" id="lorentzfit"><a class="viewcode-back" href="../functions.html#functions.lorentzfit">[docs]</a><span class="k">def</span> <span class="nf">lorentzfit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">wid</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits peak as an optimization problem.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to fit. Single vector.</span>

<span class="sd">    :type ax: list[float]</span>
<span class="sd">    :param ax: x axis.</span>

<span class="sd">    :type pos: int</span>
<span class="sd">    :param pos: Peak index to fit to.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: index positions to look to each side. The default is 20.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Possible index shift of the peak. The default is 5.</span>

<span class="sd">    :type wid: float</span>
<span class="sd">    :param wid: Initial width of fit. The default is 5.</span>

<span class="sd">    :returns: Fitted curve.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initial guesses</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>      
    <span class="n">look</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">look</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">wid</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if no axis is passed</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
    
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
            <span class="c1"># fit.append(x[0] * x[1] ** 2 / ((ax[i] - x[2])**2 + x[1] ** 2)) </span>
            
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">look</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">look</span><span class="p">):</span>  <span class="c1"># error between +-look of the peak position</span>
            <span class="n">error</span> <span class="o">+=</span> <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># total error</span>
        <span class="k">return</span> <span class="n">error</span>

    <span class="k">def</span> <span class="nf">constraint1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">amp</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>  <span class="c1"># master vector to optimize, initial values</span>
    <span class="n">bnds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">200</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="p">[(</span><span class="n">p</span><span class="o">-</span><span class="n">s</span><span class="p">),</span> <span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">s</span><span class="p">)]]</span>
    <span class="n">con1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint1</span><span class="p">}</span>
    <span class="n">cons</span> <span class="o">=</span> <span class="p">([</span><span class="n">con1</span><span class="p">])</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
        <span class="c1"># fit.append(x[0] * x[1] ** 2 / ((ax[l] - x[2]) ** 2 + x[1] ** 2))</span>
        <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="gaussfit"><a class="viewcode-back" href="../functions.html#functions.gaussfit">[docs]</a><span class="k">def</span> <span class="nf">gaussfit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">4.4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits peak as an optimization problem.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to fit. Single vector.</span>

<span class="sd">    :type ax: list[float]</span>
<span class="sd">    :param ax: x axis.</span>

<span class="sd">    :type pos: int</span>
<span class="sd">    :param pos: Peak index to fit to.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: index positions to look to each side. The default is 20.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Possible index shift of the peak. The default is 5.</span>
<span class="sd">   </span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :param sigma: Sigma value for Gaussian fit. The default is 4.4.</span>

<span class="sd">    :returns: Fitted curve.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initial guesses</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>      
    <span class="n">look</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">look</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if no axis is passed</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
    
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
        
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">11</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
        
            <span class="c1"># fit.append(x[0] * x[1] ** 2 / ((ax[i] - x[2]) ** 2 + x[1] ** 2))            </span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">look</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">look</span><span class="p">):</span>  <span class="c1"># error between +-look of the peak position</span>
            <span class="n">error</span> <span class="o">+=</span> <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># total error</span>
        <span class="k">return</span> <span class="n">error</span>

    <span class="k">def</span> <span class="nf">constraint1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">amp</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>  <span class="c1"># master vector to optimize, initial values</span>
    <span class="n">bnds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="p">[(</span><span class="n">p</span><span class="o">-</span><span class="n">s</span><span class="p">),</span> <span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">s</span><span class="p">)]]</span>
    <span class="n">con1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint1</span><span class="p">}</span>
    <span class="n">cons</span> <span class="o">=</span> <span class="p">([</span><span class="n">con1</span><span class="p">])</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
        <span class="c1"># fit.append(x[0] * x[1] ** 2 / ((ax[l] - x[2]) ** 2 + x[1] ** 2))</span>
        <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">11</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(((</span><span class="n">ax</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="studentfit"><a class="viewcode-back" href="../functions.html#functions.studentfit">[docs]</a><span class="k">def</span> <span class="nf">studentfit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="mf">4.4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fits peak as an optimization problem.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to fit. Single vector.</span>

<span class="sd">    :type ax: list[float]</span>
<span class="sd">    :param ax: x axis.</span>

<span class="sd">    :type pos: int</span>
<span class="sd">    :param pos: Peak index to fit to.</span>

<span class="sd">    :type look: int</span>
<span class="sd">    :param look: index positions to look to each side. The default is 20.</span>

<span class="sd">    :type shift: int</span>
<span class="sd">    :param shift: Possible index shift of the peak. The default is 5.</span>
<span class="sd">   </span>
<span class="sd">    :type sigma: float</span>
<span class="sd">    :param sigma: Sigma value for Gaussian fit. The default is 4.4.</span>

<span class="sd">    :returns: Fitted curve.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initial guesses</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>      
    <span class="n">look</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">look</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if no axis is passed</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
    
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">]:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>  <span class="c1"># for all the points</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">d</span><span class="p">)))</span>       
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="n">look</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">look</span><span class="p">):</span>  <span class="c1"># error between +-look of the peak position</span>
            <span class="n">error</span> <span class="o">+=</span> <span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># total error</span>
        <span class="k">return</span> <span class="n">error</span>

    <span class="k">def</span> <span class="nf">constraint1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">amp</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>  <span class="c1"># master vector to optimize, initial values</span>
    <span class="n">bnds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span> <span class="p">[(</span><span class="n">p</span><span class="o">-</span><span class="n">s</span><span class="p">),</span> <span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">s</span><span class="p">)]]</span>
    <span class="n">con1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">constraint1</span><span class="p">}</span>
    <span class="n">cons</span> <span class="o">=</span> <span class="p">([</span><span class="n">con1</span><span class="p">])</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span>  <span class="c1"># for all the points</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">gamma</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        
        <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">d</span><span class="p">)))</span> 
    <span class="k">return</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="decbound"><a class="viewcode-back" href="../functions.html#functions.decbound">[docs]</a><span class="k">def</span> <span class="nf">decbound</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">xlims</span><span class="p">,</span> <span class="n">ylims</span><span class="p">,</span> <span class="n">divs</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Decision Boundaries.</span>

<span class="sd">    :type xx: list[float]</span>
<span class="sd">    :param xx: X coordinates of centroids.</span>

<span class="sd">    :type yy: list[float]</span>
<span class="sd">    :param yy: Y coordinates of centroids.</span>

<span class="sd">    :type xlims: list[float]</span>
<span class="sd">    :param xlims: Limits.</span>

<span class="sd">    :type ylims: list[float]</span>
<span class="sd">    :param ylims: Limits.</span>

<span class="sd">    :type divs: float</span>
<span class="sd">    :param divs: Resolution. The default is 0.01.</span>

<span class="sd">    :returns: The decision boundaries.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cmx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>  <span class="c1"># centroids</span>
    <span class="n">cmy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
    <span class="n">divs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">divs</span><span class="p">)</span>  <span class="c1"># step</span>
    <span class="n">map_x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span> <span class="o">/</span> <span class="n">divs</span><span class="p">)</span>  <span class="c1"># mapping limits</span>
    <span class="n">map_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span> <span class="o">/</span> <span class="n">divs</span><span class="p">)</span>

    <span class="n">x_divs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">map_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">map_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># mapping combining &#39;divs&#39; &amp; &#39;lims&#39;</span>
    <span class="n">y_divs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">map_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">map_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">x_cords</span> <span class="o">=</span> <span class="p">[</span><span class="n">divs</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">map_x</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">map_x</span><span class="p">)))]</span>  <span class="c1"># coordinates</span>
    <span class="n">y_cords</span> <span class="o">=</span> <span class="p">[</span><span class="n">divs</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">map_y</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">map_y</span><span class="p">)))]</span>

    <span class="n">pmap</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_divs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_divs</span><span class="p">)]</span>  <span class="c1"># matrix</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_cords</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cords</span><span class="p">)):</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="mi">9999999999999999999999999</span>
            <span class="c1"># grad = [] #####</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cmx</span><span class="p">)):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmx</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_cords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">cmy</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_cords</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="c1"># grad.append(d) ####</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">t1</span><span class="p">:</span>
                    <span class="n">t1</span> <span class="o">=</span> <span class="n">d</span>
                    <span class="n">pmap</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
            <span class="c1"># grad = np.array(grad)/sum(grad) #####</span>
            <span class="c1"># pmap[j][i] = 0 ####</span>
            <span class="c1"># for k in range(len(grad)): ####</span>
            <span class="c1">#    pmap[j][i] += len(grad) - (k+1)*grad[k] ###</span>
    <span class="k">return</span> <span class="n">pmap</span></div>


<div class="viewcode-block" id="regression"><a class="viewcode-back" href="../functions.html#functions.regression">[docs]</a><span class="k">def</span> <span class="nf">regression</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs an N dimensional regression.</span>

<span class="sd">    :type target: list[float]</span>
<span class="sd">    :param target: Y-axis values, values to predict.</span>

<span class="sd">    :type variable: list[float]</span>
<span class="sd">    :param variable: X-axis values.</span>

<span class="sd">    :type cov: int</span>
<span class="sd">    :param cov: If 1 is regression with covariance, like spearman. The default is 0.</span>

<span class="sd">    :returns: Prediction of the fitting and the Fitting parameters.</span>
<span class="sd">    :rtype: list[list[float],list[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">master</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cov</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">master</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>  <span class="c1"># array of arrays</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>  <span class="c1"># ascending values</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">])</span>  <span class="c1"># 1st col is 1st var</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">)):</span>  <span class="c1"># for all variables and target</span>
            <span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># insert into dataframe</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)])</span>  <span class="c1"># sort ascending</span>
            <span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pos</span>  <span class="c1"># translate to position</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>  <span class="c1"># reorder to maintain original position</span>

        <span class="n">master</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="n">A</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># fit function parameter</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>  <span class="c1"># for all the data points</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">)):</span>
            <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>  <span class="c1"># A value</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># transpose matrix</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">I</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">b</span>  <span class="c1"># evaluate fir</span>

    <span class="n">prediction</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">master</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">+=</span> <span class="n">master</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">fit</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">+=</span> <span class="n">fit</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">prediction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">fit</span></div>


<div class="viewcode-block" id="decdensity"><a class="viewcode-back" href="../functions.html#functions.decdensity">[docs]</a><span class="k">def</span> <span class="nf">decdensity</span><span class="p">(</span><span class="n">lims</span><span class="p">,</span> <span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">divs</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the density decision map from a cluster mapping.</span>

<span class="sd">    :type lims: list[float]</span>
<span class="sd">    :param lims: Plot and calculation limits.</span>

<span class="sd">    :type x_points: list[float]</span>
<span class="sd">    :param x_points: X coordinates of each point.</span>

<span class="sd">    :type y_points: list[float]</span>
<span class="sd">    :param y_points: Y coordinates of each point.</span>

<span class="sd">    :type groups: list[int]</span>
<span class="sd">    :param groups: List of targets for each point.</span>

<span class="sd">    :type divs: float</span>
<span class="sd">    :param divs: Resolution ti calculate density. The default is 0.5.</span>

<span class="sd">    :returns: The density decision map.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">divs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">divs</span><span class="p">)</span>

    <span class="n">map_x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lims</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">divs</span><span class="p">)</span>  <span class="c1"># mapping limits</span>
    <span class="n">map_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lims</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span> <span class="o">/</span> <span class="n">divs</span><span class="p">)</span>

    <span class="n">x_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span>
    <span class="n">y_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_points</span><span class="p">)</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
    <span class="n">n_groups</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># number of groups</span>

    <span class="n">x_divs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">map_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">map_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># divisons for mapping</span>
    <span class="n">y_divs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">map_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">map_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">x_cords</span> <span class="o">=</span> <span class="p">[</span><span class="n">divs</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">map_x</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">map_x</span><span class="p">)))]</span>  <span class="c1"># coordinates</span>
    <span class="n">y_cords</span> <span class="o">=</span> <span class="p">[</span><span class="n">divs</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">map_y</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">map_y</span><span class="p">)))]</span>

    <span class="n">master</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># to store the maps for each group</span>

    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_groups</span><span class="p">):</span>
        <span class="n">pmap</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_divs</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_divs</span><span class="p">)]</span>  <span class="c1"># individual matrices</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_cords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_cords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_p</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x_cords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x_p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x_cords</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                            <span class="n">y_cords</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y_p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y_cords</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                            <span class="n">groups</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">):</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        
              
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1">###############    </span>
                    <span class="n">pmap</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pmap</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">#########</span>


        <span class="n">maximum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">pmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span> <span class="o">/</span> <span class="n">maximum</span>
        <span class="n">master</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">master</span></div>


<div class="viewcode-block" id="colormap"><a class="viewcode-back" href="../functions.html#functions.colormap">[docs]</a><span class="k">def</span> <span class="nf">colormap</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;my_name&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Just to simplify a bit the creation of colormaps.</span>

<span class="sd">    :type colors: list</span>
<span class="sd">    :param colors: List of colors thaat you ant on the colormap</span>

<span class="sd">    :type name: string, optional</span>
<span class="sd">    :param name: Name of the colormap. The default is &#39;my_name&#39;.</span>

<span class="sd">    :type n: int, optional</span>
<span class="sd">    :param n: Divisions. The default is 100.</span>

<span class="sd">    :returns: Colormap in Matplotlib format.</span>
<span class="sd">    :rtype: cmap</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">return</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">n</span><span class="p">)</span></div>


<div class="viewcode-block" id="isaxis"><a class="viewcode-back" href="../functions.html#functions.isaxis">[docs]</a><span class="k">def</span> <span class="nf">isaxis</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detects if there is an axis in the data.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data containing spectras an possible axis.</span>

<span class="sd">    :returns: True if there is axis.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">is_axis</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># there is axis by default</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># axis should be the first</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># check all the vector</span>
        <span class="k">if</span> <span class="n">axis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">axis</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">is_axis</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">is_axis</span></div>


<div class="viewcode-block" id="trim"><a class="viewcode-back" href="../functions.html#functions.trim">[docs]</a><span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deletes columns in a list from start to finish.</span>

<span class="sd">    :type data: list</span>
<span class="sd">    :param data: Data to be trimmed. Single vector at the moment.</span>

<span class="sd">    :type start: int, optional</span>
<span class="sd">    :param start: Poistion of the starting point. The default is 0.</span>

<span class="sd">    :type finish: int, optional</span>
<span class="sd">    :param finish: Position of the ending point (not included). The default is 0.</span>

<span class="sd">    :returns: Trimmed data.</span>
<span class="sd">    :rtype: list[]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">finish</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">finish</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">finish</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">finish</span> <span class="o">-</span> <span class="n">start</span>    
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">j</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   
            <span class="n">final</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">final</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">finish</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">finish</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">finish</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
        <span class="n">t</span> <span class="o">=</span> <span class="n">finish</span> <span class="o">-</span> <span class="n">start</span>
    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="shuffle"><a class="viewcode-back" href="../functions.html#functions.shuffle">[docs]</a><span class="k">def</span> <span class="nf">shuffle</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">delratio</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges and shuffles data and then separates it so it is shuffles together.</span>

<span class="sd">    :type arrays: list[list[float]]</span>
<span class="sd">    :param arrays: List of arrays of data.</span>

<span class="sd">    :type delratio: float</span>
<span class="sd">    :param delratio: Ratio of the data to be deleted, 0 &lt; delratio &lt; 1</span>

<span class="sd">    :returns: List of the shuffled arrays.</span>
<span class="sd">    :rtype: list[list[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span>
    <span class="n">delratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">delratio</span><span class="p">)</span>

    <span class="n">features</span> <span class="o">=</span> <span class="n">all_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_list</span><span class="p">)):</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">features</span><span class="p">,</span> <span class="n">all_list</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>  <span class="c1"># shuffle data before training the ML</span>

    <span class="k">if</span> <span class="n">delratio</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># to random delete an amount of data</span>
        <span class="k">if</span> <span class="n">delratio</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">delratio</span> <span class="o">=</span> <span class="mf">0.99</span>

        <span class="n">delnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">delratio</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)))</span>  <span class="c1"># amount to delete</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delnum</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>  <span class="c1"># row to delete</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">new_list</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">all_list</span><span class="p">]</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if lists are 2d</span>
            <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># save the length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># otherwise is only 1 number</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_list</span><span class="p">)):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">finish</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">finish</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">new_list</span></div>


<div class="viewcode-block" id="mergedata"><a class="viewcode-back" href="../functions.html#functions.mergedata">[docs]</a><span class="k">def</span> <span class="nf">mergedata</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges data, it can merge large vectors. Useful to merge features</span>
<span class="sd">    before performing ML algorithms.</span>

<span class="sd">    :type data: list[list[float]]</span>
<span class="sd">    :param data: List of arrays.</span>

<span class="sd">    :returns: List with the merged data.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># list of lists</span>
    <span class="n">master</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">master</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">master</span></div>


<div class="viewcode-block" id="shiftref"><a class="viewcode-back" href="../functions.html#functions.shiftref">[docs]</a><span class="k">def</span> <span class="nf">shiftref</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">ref_axis</span><span class="p">,</span> <span class="n">ref_peak</span><span class="o">=</span><span class="mi">520</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">it</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shifts the x-axis according to a shift calculated prior.</span>

<span class="sd">    :type ref_data: list[float]</span>
<span class="sd">    :param ref_data: Reference measurement.</span>

<span class="sd">    :type ref_axis: list[float]</span>
<span class="sd">    :param ref_axis: X-axis of the reference measurement.</span>

<span class="sd">    :type ref_peak: float</span>
<span class="sd">    :param ref_peak: Where the reference peak should be in x-axis values. The default is 520 (Raman Si).</span>

<span class="sd">    :type mode: int</span>
<span class="sd">    :param mode: Fitting method, Lorentz, Gaussian, or none (1,2,3). The default is 1.</span>

<span class="sd">    :type it: int</span>
<span class="sd">    :param it: Fitting iterations. The default is 100.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True plots a visual aid. The default is True.</span>

<span class="sd">    :returns: Shift amount</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)</span>
    <span class="n">ref_axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">)</span>
    <span class="n">ref_peak</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ref_peak</span><span class="p">)</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># fit curves(s), if selected</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># axis shift array</span>
    
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)):</span>  <span class="c1"># depending on the mode chosen...</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lorentzfit</span><span class="p">(</span><span class="n">ref_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="n">it</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaussfit</span><span class="p">(</span><span class="n">ref_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">4.4</span><span class="p">,</span> <span class="n">it</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lorentzfit</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">ref_axis</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaussfit</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">ref_axis</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="n">it</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fit</span><span class="p">)):</span>  <span class="c1"># look for the shift with max value (peak)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>  <span class="c1"># loop in all axis</span>
            <span class="k">if</span> <span class="n">fit</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">fit</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>  <span class="c1"># if it is the max value,</span>
                <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">ref_peak</span><span class="p">)</span>  <span class="c1"># calculate the diference</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shift</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">ref_peak</span><span class="p">)</span>  <span class="c1"># calculate the diference</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># temporal variable</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shift</span><span class="p">)):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">shift</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># make the average</span>

    <span class="n">peakshift</span> <span class="o">=</span> <span class="o">-</span><span class="n">temp</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c1"># figsize = (16,9)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ref_data</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ref_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ref_axis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fit</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ref_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ref_peak</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ref_peak</span> <span class="o">-</span> <span class="n">peakshift</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ref_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Meas. Max.&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ref_peak</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span> <span class="n">ref_peak</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span>
        <span class="c1"># plt.gca().set_ylim(0, 2)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;a.u.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Shift (cm-1)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">peakshift</span></div>


<div class="viewcode-block" id="classify"><a class="viewcode-back" href="../functions.html#functions.classify">[docs]</a><span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gnumber</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">glimits</span><span class="o">=</span><span class="p">[],</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classifies targets according to either defined limits or number of groups.</span>
<span class="sd">    The latter depends on the defined parameters.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Vector with target values to be classified.</span>

<span class="sd">    :type gnumber: int</span>
<span class="sd">    :param gnumber: Number of groups to create. The default is 3 and is the default technique.</span>

<span class="sd">    :type glimits: list[float]</span>
<span class="sd">    :param glimits: Defined group limits. The default is [].</span>
<span class="sd">    </span>
<span class="sd">    :type var: string</span>
<span class="sd">    :param glimits: Name of the variable that is being classified.</span>

<span class="sd">    :returns: Vector with the classification from 0 to N. A list with strings with the name of the groups, useful for plotting.</span>
<span class="sd">    :rtype: list[list,list]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gnumber</span><span class="p">)</span>
    <span class="n">group_limits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">glimits</span><span class="p">)</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># df_targets[&#39;T&#39;] is data from the file, [&#39;NT&#39;] the classification (0 to ...)</span>
    <span class="n">df_targets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
    <span class="n">group_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">class_targets</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [&#39;NT&#39;]</span>

    <span class="c1"># if I set the number of groups</span>
    <span class="k">if</span> <span class="n">group_number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">group_limits</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group_number</span><span class="p">)]</span>
        <span class="n">df_targets</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">group_size</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">/</span> <span class="n">group_number</span><span class="p">)</span>
        <span class="n">left_over</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">-</span> <span class="n">group_size</span> <span class="o">*</span> <span class="n">group_number</span>
        <span class="n">g_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group_number</span><span class="p">):</span>
            <span class="n">g_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group_size</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">group_number</span><span class="p">)</span> <span class="o">*</span> <span class="n">left_over</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g_s</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g_s</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">class_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_targets</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group_number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">group_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">g_s</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">g_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>   
        
        <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &lt;= &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &lt;= &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        
        <span class="n">df_targets</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">class_targets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_targets</span><span class="p">[</span><span class="s1">&#39;NT&#39;</span><span class="p">])</span>
        
        <span class="c1"># if I set the limits</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">group_number</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">class_targets</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">))]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)):</span>

                <span class="k">if</span> <span class="n">targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">group_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">class_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="n">targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">group_limits</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">class_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span>
                <span class="c1"># targets[j] &gt;= group_limits[i] and targets[j] &lt; group_limits[i+1]:</span>
                <span class="k">elif</span> <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">group_limits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">class_targets</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &lt;= &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">group_limits</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">group_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">group_limits</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &lt;= &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">class_targets</span><span class="p">,</span> <span class="n">group_names</span></div>


<div class="viewcode-block" id="subtractref"><a class="viewcode-back" href="../functions.html#functions.subtractref">[docs]</a><span class="k">def</span> <span class="nf">subtractref</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">plot_lim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subtracts a reference spectra (i.e.: air) from the measurements.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of or single vector.</span>

<span class="sd">    :type ref: list[float]</span>
<span class="sd">    :param ref: reference data to remove.</span>

<span class="sd">    :type axis: list[float]</span>
<span class="sd">    :param axis: Axis for both ´data´ and &#39;ref&#39;, only for plotting purposes.</span>

<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: Manual multiplier. The default is 0.9.</span>

<span class="sd">    :type sample: int</span>
<span class="sd">    :param sample: Sample spectra to work with. The default is 0.</span>

<span class="sd">    :type plot_lim: list[int]</span>
<span class="sd">    :param plot_lim: Limits of the plot.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: To plot or not a visual aid. The default is True.</span>

<span class="sd">    :returns: Data with the subtracted reference.</span>
<span class="sd">    :rtype: list`[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>  <span class="c1"># spectrum chosen to work with. 0 is the first</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>  <span class="c1"># multiplication factor to delete the ref spectrum on the sample</span>
    
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha</span>  
        <span class="n">toplot</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span>
        <span class="n">final</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">toplot</span><span class="p">)</span> <span class="o">-</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">toplot</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha</span>    
        <span class="n">data</span> <span class="o">=</span> <span class="n">final</span>
        
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ref</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">toplot</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Air&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Final&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">plot_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">plot_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plot_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;a.u.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Shift (cm-1)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="pearson"><a class="viewcode-back" href="../functions.html#functions.pearson">[docs]</a><span class="k">def</span> <span class="nf">pearson</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">cm</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span><span class="p">,</span> <span class="n">fons</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figs</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span> <span class="n">tfs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
            <span class="n">ti</span><span class="o">=</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Pearson matrix and plots it.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to correlate.</span>

<span class="sd">    :type labels: list[str]</span>
<span class="sd">    :param labels: Labels of the data.</span>

<span class="sd">    :type cm: str</span>
<span class="sd">    :param cm: Color map as for matplolib. The default is &quot;seismic&quot;.</span>

<span class="sd">    :type fons: int</span>
<span class="sd">    :param fons: Plot font size. The default is 20.</span>

<span class="sd">    :type figs: tuple</span>
<span class="sd">    :param figs: Plot size. The default is (20,17).</span>

<span class="sd">    :type tfs: int</span>
<span class="sd">    :param tfs: Title font size. The default is 25.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True plots the matrix. The default is True.</span>

<span class="sd">    :type ti: str</span>
<span class="sd">    :param ti: Plot title/name. The default is &quot;spearman&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">fonsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fons</span><span class="p">)</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
    <span class="n">titlefs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tfs</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

    <span class="n">pears</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cordsi</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># coordinates, same order as labels</span>
    <span class="n">cordsj</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># coordinates, same order as labels</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># for all sets</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># compare with all sets</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">pears</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">cordsi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">cordsj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>

    <span class="n">merged_pears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">pears</span><span class="p">,</span> <span class="n">cordsi</span><span class="p">,</span> <span class="n">cordsj</span><span class="p">]</span>  <span class="c1"># merge to sort together</span>
    <span class="n">merged_pears</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">merged_pears</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># delete the first n (the obvious 1s)</span>
        <span class="n">merged_pears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged_pears</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>  <span class="c1"># delete the repeated half</span>
        <span class="n">merged_pears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged_pears</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">pears</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pears</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>  <span class="c1"># [pearson coeff, p-value]</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fonsize</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">formatt</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedFormatter</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>    
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">pears</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">titlefs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatt</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatt</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;90&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pears</span></div>

<div class="viewcode-block" id="spearman"><a class="viewcode-back" href="../functions.html#functions.spearman">[docs]</a><span class="k">def</span> <span class="nf">spearman</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">cm</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span><span class="p">,</span> <span class="n">fons</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figs</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span> <span class="n">tfs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ti</span><span class="o">=</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates Pearson matrix and plots it.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to correlate.</span>

<span class="sd">    :type labels: list[str]</span>
<span class="sd">    :param labels: Labels of the data.</span>

<span class="sd">    :type cm: str</span>
<span class="sd">    :param cm: Color map as for matplolib. The default is &quot;seismic&quot;.</span>

<span class="sd">    :type fons: int</span>
<span class="sd">    :param fons: Plot font size. The default is 20.</span>

<span class="sd">    :type figs: tuple</span>
<span class="sd">    :param figs: Plot size. The default is (20,17).</span>

<span class="sd">    :type tfs: int</span>
<span class="sd">    :param tfs: Title font size. The default is 25.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True plots the matrix. The default is True.</span>

<span class="sd">    :type ti: str</span>
<span class="sd">    :param ti: Plot title/name. The default is &quot;spearman&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">fonsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fons</span><span class="p">)</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
    <span class="n">titlefs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tfs</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

    <span class="n">spear</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># spearman</span>
    <span class="n">cordsi</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># coordinates, same order as labels</span>
    <span class="n">cordsj</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># coordinates, same order as labels</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># compare with all sets</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">spear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">cordsi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">cordsj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>

    <span class="n">merged_spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">spear</span><span class="p">,</span> <span class="n">cordsi</span><span class="p">,</span> <span class="n">cordsj</span><span class="p">]</span>  <span class="c1"># merge to sort together</span>
    <span class="n">merged_spear</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">merged_spear</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>  <span class="c1"># delete the first n (the obvious 1s)</span>
        <span class="n">merged_spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged_spear</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)):</span>  <span class="c1"># delete the repeated half</span>
        <span class="n">merged_spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">merged_spear</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">spear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">spear</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>  <span class="c1"># [rho spearman, p-value]</span>

    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fonsize</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">formatt</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FixedFormatter</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">spear</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">titlefs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatt</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatt</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;90&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">spear</span></div>


<div class="viewcode-block" id="grau"><a class="viewcode-back" href="../functions.html#functions.grau">[docs]</a><span class="k">def</span> <span class="nf">grau</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span> <span class="n">cm</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span><span class="p">,</span> <span class="n">fons</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">figs</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
         <span class="n">tfs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ti</span><span class="o">=</span><span class="s2">&quot;Grau (Beta)&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">marks</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs Grau correlation matrix and plots it.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to be correlated.</span>

<span class="sd">    :type labels: list[str]</span>
<span class="sd">    :param labels: Labels of the data to be ploted.</span>

<span class="sd">    :type cm: str</span>
<span class="sd">    :param cm: Color map for the plot, from matplotlib. The default is &quot;seismic&quot;.</span>

<span class="sd">    :type fons: int, optional</span>
<span class="sd">    :param fons: Plot font size. The default is 20.</span>

<span class="sd">    :type figs: tuple</span>
<span class="sd">    :param figs: Figure size. The default is (25,15).</span>

<span class="sd">    :type tfs: int</span>
<span class="sd">    :param tfs: Plot title font size. The default is 25.</span>

<span class="sd">    :type ti: str</span>
<span class="sd">    :param ti: Plot title. The default is &quot;Grau (Beta)&quot;.</span>

<span class="sd">    :type marker: str</span>
<span class="sd">    :param marker: Plot marker type (scatter). The default is &quot;s&quot;.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True plots the matrix. The default is True.</span>

<span class="sd">    :type marks: int</span>
<span class="sd">    :param marks: DESCRIPTION. The default is 100.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fons</span><span class="p">)</span>  <span class="c1"># plot font size</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>  <span class="c1"># plot size</span>
    <span class="n">titlefs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tfs</span><span class="p">)</span>  <span class="c1"># title font size</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>  <span class="c1"># plot name</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>  <span class="c1"># market style</span>
    <span class="n">markersize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">marks</span><span class="p">)</span>  <span class="c1"># marker size</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

    <span class="n">graus</span> <span class="o">=</span> <span class="n">evalgrau</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># grau correlation (3d R2)</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="p">[</span><span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">))]</span>  <span class="c1"># first dimension values</span>
    <span class="n">g2</span> <span class="o">=</span> <span class="p">[</span><span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">))]</span>  <span class="c1"># second dimension values</span>
    <span class="n">g3</span> <span class="o">=</span> <span class="p">[</span><span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">))]</span>  <span class="c1"># third dimension values</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="p">[</span><span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">))]</span>  <span class="c1"># mse&#39;s list</span>
    <span class="n">g2_shift</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>  <span class="c1"># copy v2 to displace the d2 values for plotting</span>
    <span class="n">t_c</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of ticks per subplot</span>
    <span class="n">xtick_labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list for labels</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># number of different # in combs[i][0] (first column), starts with 1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># for all combinations</span>
        <span class="k">if</span> <span class="n">graus</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">graus</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># if it is different</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># then it is a new one</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>  <span class="c1"># for all the different first positions</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># temporal variable to count ticks</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graus</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># check all the combinations</span>
            <span class="k">if</span> <span class="n">graus</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># if it is the one we are looking for</span>
                <span class="k">if</span> <span class="n">graus</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">graus</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># if it changes, then new tick</span>
                    <span class="n">temp</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># add</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if it doesnt count, is because there is only 1</span>
            <span class="n">t_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># so append 1</span>
        <span class="k">elif</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># if only 1 is counted</span>
            <span class="n">t_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># then add a 2</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># otherwise,</span>
            <span class="n">t_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>  <span class="c1"># when it is done, append to the list</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_c</span><span class="p">)):</span>  <span class="c1"># for all the different #</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t_c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># for the number of different 2d</span>
            <span class="n">xtick_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>  <span class="c1"># append the value +1</span>
    <span class="n">xtick_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># append &#39;&#39; for the last label to be blank</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">g1</span><span class="p">)):</span>  <span class="c1"># to shift the position for plotting</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_c</span><span class="p">)):</span>  <span class="c1"># for all the ticks in x axis</span>
            <span class="k">if</span> <span class="n">g1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">j</span><span class="p">:</span>  <span class="c1"># if bigger than 0 (first)</span>
                <span class="n">g2_shift</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">t_c</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># shift (add) all the previous</span>


    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>   
    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="n">y_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">g3</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">g3</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">x_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">g2_shift</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">ytick_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)):</span>
        <span class="n">ytick_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">y_ticks</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xtick_labels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">xtick_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">xtick_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">titlefs</span><span class="p">)</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">g2_shift</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">mse</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xtick_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;90&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ytick_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t_c</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">+=</span> <span class="n">t_c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xgridlines</span><span class="p">()[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xgridlines</span><span class="p">()[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xgridlines</span><span class="p">()[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">g2_shift</span></div>


<div class="viewcode-block" id="moveavg"><a class="viewcode-back" href="../functions.html#functions.moveavg">[docs]</a><span class="k">def</span> <span class="nf">moveavg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">move</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the moving average of a single or multiple vectors.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to calculate the moving average. Single or multiple vectors.</span>

<span class="sd">    :type move: int</span>
<span class="sd">    :param move: Average range to each side (total average = move + 1).</span>

<span class="sd">    :returns: Smoothed vector(s).</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">move</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
    <span class="n">b_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># for smoothed data</span>

    <span class="k">if</span> <span class="n">dims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_data</span><span class="p">)):</span>  <span class="c1"># each measured point</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="n">data_len</span> <span class="o">-</span> <span class="n">move</span><span class="p">):</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b_data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="n">move</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">move</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">move</span><span class="p">):</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">temp</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="n">data_len</span> <span class="o">-</span> <span class="n">move</span><span class="p">):</span>
            <span class="n">avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b_data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">move</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">move</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">move</span><span class="p">):</span>
            <span class="n">avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">avg</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">avg</span></div>


<div class="viewcode-block" id="plot2dml"><a class="viewcode-back" href="../functions.html#functions.plot2dml">[docs]</a><span class="k">def</span> <span class="nf">plot2dml</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="p">[],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">,</span> <span class="s1">&#39;D2&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">train_pred</span><span class="o">=</span><span class="p">[],</span> 
             <span class="n">test_pred</span><span class="o">=</span><span class="p">[],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xax</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">yax</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> 
             <span class="n">lfs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots 2-dimensional results from LDA, PCA, NCA, or similar machine learning</span>
<span class="sd">    algoruthms where the output has 2 features per sample.</span>
<span class="sd">    </span>
<span class="sd">    :type train: pandas frame</span>
<span class="sd">    :param train: Results for the training set. Pandas frame with the 2 dimensions</span>
<span class="sd">        and target columns.</span>

<span class="sd">    :type test: pandas frame</span>
<span class="sd">    :param test: Results for the test set. Pandas frame with the 2 dimensions</span>
<span class="sd">        and target columns.</span>
<span class="sd">    </span>
<span class="sd">    :type names: list[str]</span>
<span class="sd">    :param names: Name of the lables in the dataframe. For example, for LDA:</span>
<span class="sd">        D1, D2 and T.    </span>
<span class="sd">    </span>
<span class="sd">    :type train_pred: list</span>
<span class="sd">    :param train_pred: Prediction of the training set.</span>

<span class="sd">    :type test_pred: list</span>
<span class="sd">    :param test_pred: Prediction of the test set.</span>

<span class="sd">    :type labels: list</span>
<span class="sd">    :param labels: Names for the classification groups, if any.</span>
<span class="sd">        </span>
<span class="sd">    :type title: str</span>
<span class="sd">    :param title: Title of the plot.</span>
<span class="sd">        </span>
<span class="sd">    :type xax: str</span>
<span class="sd">    :param xax: Name ox x-axis</span>
<span class="sd">        </span>
<span class="sd">    :type yax: str</span>
<span class="sd">    :param yax: Name of y-axis</span>
<span class="sd">        </span>
<span class="sd">    :type lfs: int</span>
<span class="sd">    :param lfs: Legend font size. Default is 15.</span>
<span class="sd">        </span>
<span class="sd">    :type loc: str</span>
<span class="sd">    :param loc: Location of legend. Default is best.</span>
<span class="sd">    </span>
<span class="sd">    :type size: int</span>
<span class="sd">    :param size: Size of the markers. Default is 20.</span>
<span class="sd">    </span>
<span class="sd">    :type xlim: list</span>
<span class="sd">    :param xlim: Limits of the x axis.</span>
<span class="sd">    </span>
<span class="sd">    :type ylim: list</span>
<span class="sd">    :param ylim: Limits of the y axis.</span>
<span class="sd">    </span>
<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True it plot. Only for test purposes.</span>
<span class="sd">        </span>
<span class="sd">    :returns: Plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
              <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">]</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;olive&#39;</span><span class="p">,</span> <span class="s1">&#39;lime&#39;</span><span class="p">,</span>
             <span class="s1">&#39;springgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;mediumspringgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;turquoise&#39;</span><span class="p">,</span> <span class="s1">&#39;indigo&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;deeppink&#39;</span><span class="p">,</span> <span class="s1">&#39;crimson&#39;</span><span class="p">]</span>
    
    <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">legend_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> 
                                   <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span> 
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)):</span>  
        <span class="n">group</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_pred</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">train_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">train</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">group</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">[</span><span class="n">group</span><span class="p">],</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">)</span>
            
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>        
        <span class="n">group</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
        
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_pred</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">test</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">ec</span> <span class="o">=</span> <span class="s1">&#39;fuchsia&#39;</span>
                
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">group</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">[</span><span class="n">group</span><span class="p">],</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">ec</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">yax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>    
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">lfs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">plot</span></div>

    
<div class="viewcode-block" id="stackplot"><a class="viewcode-back" href="../functions.html#functions.stackplot">[docs]</a><span class="k">def</span> <span class="nf">stackplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral&#39;</span><span class="p">,</span> 
              <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots a stack plot of selected spectras.</span>

<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: Data to in the plot.</span>

<span class="sd">    :type add: float</span>
<span class="sd">    :param add: displacement, or difference, between each curve.</span>

<span class="sd">    :type xlabel: str</span>
<span class="sd">    :param xlabel: Label of axis.</span>

<span class="sd">    :type ylabel: str</span>
<span class="sd">    :param ylabel: Label of axis.</span>

<span class="sd">    :type cmap: str</span>
<span class="sd">    :param cmap: Colormap, according to matplotlib options.</span>

<span class="sd">    :type figsize: tuple</span>
<span class="sd">    :param figsize: Size of the plot. Default is (3, 4.5)</span>

<span class="sd">    :type lw: float</span>
<span class="sd">    :param lw: Linewidth of the curves.</span>

<span class="sd">    :type plot: bool</span>
<span class="sd">    :param plot: If True it plot. Only for test purposes.</span>

<span class="sd">    :returns: plot</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>      
       
    <span class="n">base</span> <span class="o">=</span> <span class="p">[</span><span class="n">add</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
    
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
    
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  
        
    <span class="k">return</span> <span class="n">plot</span></div>


<div class="viewcode-block" id="cosmicmp"><a class="viewcode-back" href="../functions.html#functions.cosmicmp">[docs]</a><span class="k">def</span> <span class="nf">cosmicmp</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    https://doi.org/10.1177/0003702819839098</span>
<span class="sd">    It identifies CRs by comparing similar spectras and paring in matching</span>
<span class="sd">    pairs. Uses randomnes of CRs.</span>
<span class="sd">    </span>
<span class="sd">    :type ndata: list[float]</span>
<span class="sd">    :param ndata: List of spectras to remove cosmic rays.</span>

<span class="sd">    :type alpha: float</span>
<span class="sd">    :param alpha: Factor to modify the criteria to identify a cosmic ray.</span>

<span class="sd">    :returns: Data with removed cosmic rays.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>

    <span class="n">sim_specs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># most similar spectra (position) for each spectra i</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># for all the spectras</span>
        <span class="n">n_cov</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># position of most similar spectra, initial value</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># to compare similarity of the spectras</span>
        <span class="n">paired</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># if it is already paired with another spectra</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_specs</span><span class="p">)):</span>  <span class="c1"># check if it is already paired</span>
            <span class="k">if</span> <span class="n">sim_specs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># if it is</span>
                <span class="n">n_cov</span> <span class="o">=</span> <span class="n">j</span>  <span class="c1"># claculate nothing and just save it</span>
                <span class="n">paired</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># set as paired</span>
        
        <span class="k">if</span> <span class="n">paired</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if not paired, then calculate</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># first term of equation</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># search in all spectras</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># second term of eq.</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>  <span class="c1"># third term of eq.</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># final value to campare</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">cov</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># the highest value (covariance) wins</span>
                    <span class="n">n_cov</span> <span class="o">=</span> <span class="n">j</span>  <span class="c1"># save the best</span>
                    <span class="n">cov</span> <span class="o">=</span> <span class="n">temp</span>  <span class="c1"># save the best to compare</span>
        
        <span class="n">sim_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_cov</span><span class="p">)</span>  <span class="c1"># save the similar curve</span>
        
        <span class="n">mavg</span> <span class="o">=</span> <span class="n">moveavg</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">avg</span><span class="p">)</span>
        
        <span class="n">sigma</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">sigma</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">mavg</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>  <span class="c1"># search in all the spectra</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">sim_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sigma</span><span class="o">*</span><span class="n">alpha</span><span class="p">:</span>  <span class="c1"># if res. is higher than the stdev</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">sim_specs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># must be CR, change the value</span>
                        
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="cosmicdd"><a class="viewcode-back" href="../functions.html#functions.cosmicdd">[docs]</a><span class="k">def</span> <span class="nf">cosmicdd</span><span class="p">(</span><span class="n">ndata</span><span class="p">,</span> <span class="n">th</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">asy</span><span class="o">=</span><span class="mf">0.6745</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    https://doi.org/10.1016/j.chemolab.2018.06.009</span>
<span class="sd">    It identifies CRs by detrended differences, the differences between a</span>
<span class="sd">    value and the next.</span>
<span class="sd">    </span>
<span class="sd">    :type ndata: list[float]</span>
<span class="sd">    :param ndata: List of spectras to remove cosmic rays.</span>

<span class="sd">    :type th: float</span>
<span class="sd">    :param th: Factor to modify the criteria to identify a cosmic ray.</span>
<span class="sd">    </span>
<span class="sd">    :type asy: float</span>
<span class="sd">    :param asy: Asymptotic bias correction</span>
<span class="sd">    </span>
<span class="sd">    :type m: float</span>
<span class="sd">    :param m: Number of neighbor values to use for average.</span>

<span class="sd">    :returns: Data with removed cosmic rays.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
    
    <span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>  <span class="c1"># diff data</span>
     
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># for each spectra</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># for each step</span>
            <span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># diff with the next one</span>
    
    <span class="n">zt</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Z scores</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">:</span>  <span class="c1"># for each diff. vector</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># temporal z score</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># temporal MAD (median absolute deviation)</span>
        <span class="n">med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># just median</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># for each step in each diff. spectra</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">med</span><span class="p">))</span>  <span class="c1"># calculate MAD</span>
        <span class="n">mad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>  <span class="c1"># save MAD</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># for each step in each diff. spectra</span>
            <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asy</span><span class="o">*</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">med</span><span class="p">)</span><span class="o">/</span><span class="n">mad</span><span class="p">)</span>  <span class="c1"># calculate Z score</span>
        <span class="n">zt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># save Z score</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>  <span class="c1"># for each spectra</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># in all its len. except the last (range)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">zt</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">th</span><span class="p">:</span>  <span class="c1"># if it is larger than the th. then it is CR</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">:</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">)</span>  <span class="c1"># avg, of neighbors</span>
    
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="cosmicmed"><a class="viewcode-back" href="../functions.html#functions.cosmicmed">[docs]</a><span class="k">def</span> <span class="nf">cosmicmed</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Precise cosmic ray elimination for measurements of the same point or very</span>
<span class="sd">    similar spectras.</span>
<span class="sd">    </span>
<span class="sd">    :type data: list[float]</span>
<span class="sd">    :param data: List of spectras to remove cosmic rays.</span>

<span class="sd">    :type sigma: float</span>
<span class="sd">    :param sigma: Factor to modify the criteria to identify a cosmic ray.</span>
<span class="sd">        Multiplies the median of each bin.</span>

<span class="sd">    :returns: Data with removed cosmic rays.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>     
    <span class="n">acq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solved</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solved</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="n">med</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">solved</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">acq</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sigma</span><span class="o">*</span><span class="n">med</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">solved</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">med</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">solved</span></div>


<div class="viewcode-block" id="makeaxisstep"><a class="viewcode-back" href="../functions.html#functions.makeaxisstep">[docs]</a><span class="k">def</span> <span class="nf">makeaxisstep</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an axis, or vector, from &#39;start&#39; with bins of length &#39;step&#39; </span>
<span class="sd">    for a distance of &#39;length&#39;.</span>
<span class="sd">    </span>
<span class="sd">    :type start: float </span>
<span class="sd">    :param start: first value of the axis. Default is 0.</span>
<span class="sd">        </span>
<span class="sd">    :type step: float</span>
<span class="sd">    :param step: Step size for the axis. Default is 1.00.</span>
<span class="sd">        </span>
<span class="sd">    :type length: int</span>
<span class="sd">    :param length: LEngth of axis. Default is 1000.</span>
<span class="sd">    </span>
<span class="sd">    :type adjust: boolean</span>
<span class="sd">    :param adjust: If True, rounds (adjusts) the deimals points to the same</span>
<span class="sd">        as the step has. Default is False.</span>
<span class="sd">        </span>
<span class="sd">    :type rounded: int </span>
<span class="sd">    :param rounded: Number of decimals to consider. If -1 then no rounding is</span>
<span class="sd">        performed.</span>
<span class="sd">        </span>
<span class="sd">    :returns: Axis with the set parameters.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">adjust</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rounded</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="n">rounded</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="makeaxisdivs"><a class="viewcode-back" href="../functions.html#functions.makeaxisdivs">[docs]</a><span class="k">def</span> <span class="nf">makeaxisdivs</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">divs</span><span class="p">,</span> <span class="n">rounded</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an axis, or vector, from &#39;start&#39; to &#39;finish&#39; with &#39;divs&#39; divisions. </span>
<span class="sd">    </span>
<span class="sd">    :type start: float </span>
<span class="sd">    :param start: First value of the axis.</span>
<span class="sd">        </span>
<span class="sd">    :type finish: float</span>
<span class="sd">    :param finish: Last value of the axis.</span>
<span class="sd">        </span>
<span class="sd">    :type divs: int</span>
<span class="sd">    :param divs: Number of divisions</span>
<span class="sd">        </span>
<span class="sd">    :type rounded: int </span>
<span class="sd">    :param rounded: Number of decimals to consider. If -1 then no rounding is</span>
<span class="sd">        performed.</span>
<span class="sd">        </span>
<span class="sd">    :returns: Axis with the set parameters.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">finish</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">divs</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rounded</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span><span class="p">,</span><span class="n">rounded</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">divs</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">divs</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">axis</span></div>


<div class="viewcode-block" id="minmax"><a class="viewcode-back" href="../functions.html#functions.minmax">[docs]</a><span class="k">def</span> <span class="nf">minmax</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the vectors that contain the minimum and maximum values of each</span>
<span class="sd">    bin from a list of vectors.</span>
<span class="sd">    </span>
<span class="sd">    :type data: list </span>
<span class="sd">    :param data: List of vectors to calculate the minimum and maximum vectors.</span>
<span class="sd">                </span>
<span class="sd">    :returns: minimum and maximum vectors.</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">temp_min</span> <span class="o">=</span> <span class="mi">99999999999999999999</span>
        <span class="n">temp_max</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999999999999999999</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">temp_min</span><span class="p">:</span>
                <span class="n">temp_min</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">temp_max</span><span class="p">:</span>
                <span class="n">temp_max</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> 
        <span class="n">minimum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_min</span><span class="p">)</span>
        <span class="n">maximum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_max</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span></div>


<div class="viewcode-block" id="fwhm"><a class="viewcode-back" href="../functions.html#functions.fwhm">[docs]</a><span class="k">def</span> <span class="nf">fwhm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Full Width Half Maximum of an indeicated peak or groups of</span>
<span class="sd">    peaks for a single or multiple spectras.</span>
<span class="sd">    </span>
<span class="sd">    :type data: list</span>
<span class="sd">    :param data: spectrocopic data to calculate the fwhm from. Single vector or</span>
<span class="sd">        list of vectors.    </span>
<span class="sd">    </span>
<span class="sd">    :type peaks: float or list[float]</span>
<span class="sd">    :param peaks: Aproximate axis value of the position of the peak. If sinlge</span>
<span class="sd">        peak then a float is needed. If many peaks are requierd then a list of</span>
<span class="sd">        them.</span>
<span class="sd">        </span>
<span class="sd">    :type axis: list</span>
<span class="sd">    :param axis: Axis of the data. If none, then the axis will be 0..N where N</span>
<span class="sd">        is the length of the spectra or spectras.</span>

<span class="sd">    :type res: float</span>
<span class="sd">    :param res: Resolution in wich to calculate the width. Must be a power of </span>
<span class="sd">        10. If &#39;res=1&#39; the the axis resolution (step) is used.</span>

<span class="sd">    :type s: int</span>
<span class="sd">    :param s: Shift to sides to check real peak. The default is 5.   </span>
<span class="sd">        </span>
<span class="sd">    :returns: A list, or single float value, of the fwhm.</span>
<span class="sd">    :rtype: float or list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>
    <span class="n">dims_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims_data</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">axis_0</span> <span class="o">=</span> <span class="n">interpolation</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="p">,</span> <span class="n">new_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">axis_0</span> <span class="o">=</span> <span class="n">interpolation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">new_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="n">ind</span> <span class="o">=</span> <span class="n">valtopos</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">axis_0</span><span class="p">)</span>
    
    <span class="n">dims_peaks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims_peaks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind</span><span class="p">]</span>
    
    <span class="n">r_fwhm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dims_data</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">y_0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">h</span><span class="p">]</span>
            <span class="n">y_0</span><span class="p">,</span> <span class="n">axis_0</span> <span class="o">=</span> <span class="n">interpolation</span><span class="p">(</span><span class="n">y_0</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">new_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_0</span> <span class="o">=</span> <span class="n">y</span>
        
        <span class="n">fwhm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">y_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y_0</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]]:</span>
                    <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                    
            <span class="n">h_m</span> <span class="o">=</span> <span class="n">y_0</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># half maximum </span>
            
            <span class="n">temp</span> <span class="o">=</span> <span class="mi">999999999</span>
            <span class="n">left</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_0</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h_m</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">delta</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">delta</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">i</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="n">delta</span><span class="p">:</span>
                    <span class="k">break</span>
            
            <span class="n">temp</span> <span class="o">=</span> <span class="mi">999999999</span>
            <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axis_0</span><span class="p">)</span><span class="o">-</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_0</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">h_m</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">delta</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="n">delta</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">i</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="n">delta</span><span class="p">:</span>
                    <span class="k">break</span>
            
            <span class="k">if</span> <span class="n">dims_peaks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fwhm</span> <span class="o">=</span> <span class="n">axis_0</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">-</span> <span class="n">axis_0</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis_0</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">-</span> <span class="n">axis_0</span><span class="p">[</span><span class="n">left</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">dims_data</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">r_fwhm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fwhm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

    <span class="k">return</span> <span class="n">r_fwhm</span>   </div>


<div class="viewcode-block" id="asymmetry"><a class="viewcode-back" href="../functions.html#functions.asymmetry">[docs]</a><span class="k">def</span> <span class="nf">asymmetry</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">peak</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Full Width Half Maximum of an indeicated peak or groups of</span>
<span class="sd">    peaks for a single or multiple spectras.</span>
<span class="sd">    </span>
<span class="sd">    :type data: list</span>
<span class="sd">    :param data: spectrocopic data to calculate the fwhm from. Single vector or</span>
<span class="sd">        list of vectors.    </span>
<span class="sd">    </span>
<span class="sd">    :type peak: float, list[float]</span>
<span class="sd">    :param peak: Aproximate axis value of the position of the peak. If sinlge</span>
<span class="sd">        peak then a float is needed. If many peaks are requierd then a list of</span>
<span class="sd">        them.</span>
<span class="sd">        </span>
<span class="sd">    :type axis: list</span>
<span class="sd">    :param axis: Axis of the data. If none, then the axis will be 0..N where N</span>
<span class="sd">        is the length of the spectra or spectras.</span>

<span class="sd">    :type res: float</span>
<span class="sd">    :param res: Resolution in wich to calculate the width. Must be a power of </span>
<span class="sd">        10. If &#39;res=1&#39; the the axis resolution (step) is used.</span>

<span class="sd">    :type s: int</span>
<span class="sd">    :param s: Shift to sides to check real peak. The default is 5.   </span>
<span class="sd">        </span>
<span class="sd">    :returns: R2 value comparing both sides of the peak and a sign to tell if</span>
<span class="sd">        either left side is smaller (negative) or tight side is smaller</span>
<span class="sd">        (positive, no sign included).</span>
<span class="sd">    :rtype: list[float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">axis</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span>
    
    <span class="n">index</span> <span class="o">=</span> <span class="n">valtopos</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="n">s</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
    
    <span class="n">diff_nom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">diff_abs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
        <span class="n">diff_nom</span> <span class="o">+=</span> <span class="n">y</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">diff_abs</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">if</span> <span class="n">diff_nom</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># left side is smaller -&gt; right larger</span>
        <span class="n">diff_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">diff_abs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">diff_abs</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Institut de Recerca en Energia de Catalunya.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>